<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Arduino Internship Prototype</title>

<style>
body{
  font-family:Arial;
  margin:0;
}

#top{
  background:#222;
  padding:10px;
  color:white;
}

#top button{
  margin-right:10px;
}

#main{
  display:flex;
  height:450px;
}

#palette{
  width:180px;
  background:#2c3e50;
  color:white;
  padding:10px;
}

.part{
  background:#3498db;
  margin:8px 0;
  padding:10px;
  cursor:grab;
  text-align:center;
}

#workspace{
  flex:1;
  background:#eee;
  position:relative;
}

.component{
  position:absolute;
  width:80px;
  height:40px;
  background:#f39c12;
  text-align:center;
  line-height:40px;
  cursor:pointer;
}

#code{
  position:absolute;
  right:0;
  top:0;
  width:40%;
  height:100%;
  background:black;
  color:lime;
  padding:10px;
  display:none;
}
</style>
</head>

<body>

<div id="top">
  <button onclick="toggleCode()">Code View</button>
  <button onclick="run()">Run</button>
  <button onclick="stop()">Stop</button>
</div>

<div id="main">

  <div id="palette">
    <div class="part" draggable="true" data-type="Arduino">Arduino</div>
    <div class="part" draggable="true" data-type="LED">LED</div>
    <div class="part" draggable="true" data-type="Button">Button</div>
  </div>

  <div id="workspace" ondragover="event.preventDefault()" ondrop="dropPart(event)">
    <div id="code"></div>
  </div>

</div>

<script>

let parts=[];

function dropPart(e){
  let type = e.dataTransfer.getData("type");

  let d = document.createElement("div");
  d.className="component";
  d.innerText=type;
  d.style.left=e.offsetX+"px";
  d.style.top=e.offsetY+"px";

  document.getElementById("workspace").appendChild(d);
  parts.push(type);
  generateCode();
}

document.querySelectorAll(".part").forEach(p=>{
  p.ondragstart=e=>{
    e.dataTransfer.setData("type",p.dataset.type);
  };
});

function generateCode(){
let code=
`int led=13;
int button=2;

void setup(){
 pinMode(led,OUTPUT);
 pinMode(button,INPUT);
}

void loop(){
 if(digitalRead(button)){
  digitalWrite(led,HIGH);
 } else {
  digitalWrite(led,LOW);
 }
}
`;
document.getElementById("code").innerText=code;
}

function toggleCode(){
 let c=document.getElementById("code");
 c.style.display=c.style.display=="block"?"none":"block";
}

function run(){
 document.querySelectorAll(".component").forEach(c=>{
  if(c.innerText=="LED")
    c.style.background="red";
 });
}

function stop(){
 document.querySelectorAll(".component").forEach(c=>{
  if(c.innerText=="LED")
    c.style.background="#f39c12";
 });
}

</script>

</body>
</html>
